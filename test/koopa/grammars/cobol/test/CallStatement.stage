package koopa.grammars.cobol.test;
grammar koopa.grammars.cobol.CobolGrammar;

target callStatement;

# Simplest calls possible.
+[ CALL MY-SERVICE ]
+[ CALL "MY-SERVICE" ]
-[ CALL 42 ]
-[ CALL 42.42 ]

# Implicit "BY REFERENCE":
+[ CALL MY-SERVICE USING MY-DATA ]
+[ CALL MY-SERVICE USING "MY-DATA" ]
+[ CALL MY-SERVICE USING MY-DATA MY-OTHER-DATA ]
+[ CALL MY-SERVICE USING "MY-DATA" MY-OTHER-DATA ]

# Explicit "BY REFERENCE":
+[ CALL MY-SERVICE USING BY REFERENCE MY-DATA ]
+[ CALL MY-SERVICE USING BY REFERENCE "MY-DATA" ]
+[ CALL MY-SERVICE USING BY REFERENCE OMITTED ]
+[ CALL MY-SERVICE USING BY REFERENCE MY-DATA MY-OTHER-DATA ]
+[ CALL MY-SERVICE USING BY REFERENCE "MY-DATA" MY-OTHER-DATA ]
+[ CALL MY-SERVICE USING REFERENCE MY-DATA ]
+[ CALL MY-SERVICE USING REFERENCE MY-DATA MY-OTHER-DATA ]
+[ CALL MY-SERVICE USING REFERENCE "MY-DATA" MY-OTHER-DATA ]

# "BY CONTENT":
+[ CALL MY-SERVICE USING BY CONTENT MY-DATA ]
+[ CALL MY-SERVICE USING BY CONTENT LENGTH OF MY-DATA ]
+[ CALL MY-SERVICE USING BY CONTENT "DATA" ]
+[ CALL MY-SERVICE USING BY CONTENT 1234 ]
+[ CALL MY-SERVICE USING BY CONTENT 1234.567 ]
+[ CALL MY-SERVICE USING BY CONTENT MY-DATA MY-OTHER-DATA ]
+[ CALL MY-SERVICE USING CONTENT MY-DATA ]
+[ CALL MY-SERVICE USING CONTENT LENGTH OF MY-DATA ]
+[ CALL MY-SERVICE USING CONTENT "DATA" ]
+[ CALL MY-SERVICE USING CONTENT 1234 ]
+[ CALL MY-SERVICE USING CONTENT 1234.567 ]
+[ CALL MY-SERVICE USING CONTENT MY-DATA MY-OTHER-DATA ]

# "BY VALUE":
+[ CALL MY-SERVICE USING BY VALUE MY-DATA ]
+[ CALL MY-SERVICE USING BY VALUE LENGTH OF MY-DATA ]
+[ CALL MY-SERVICE USING BY VALUE "DATA" ]
+[ CALL MY-SERVICE USING BY VALUE 1234 ]
+[ CALL MY-SERVICE USING BY VALUE 1234.567 ]
+[ CALL MY-SERVICE USING BY VALUE MY-DATA MY-OTHER-DATA ]
+[ CALL MY-SERVICE USING VALUE MY-DATA ]
+[ CALL MY-SERVICE USING VALUE LENGTH OF MY-DATA ]
+[ CALL MY-SERVICE USING VALUE "DATA" ]
+[ CALL MY-SERVICE USING VALUE 1234 ]
+[ CALL MY-SERVICE USING VALUE 1234.567 ]
+[ CALL MY-SERVICE USING VALUE MY-DATA MY-OTHER-DATA ]

# "GIVING" and "RETURNING".
+[ CALL MY-SERVICE GIVING A ]
+[ CALL MY-SERVICE GIVING ADDRESS OF A ]
+[ CALL MY-SERVICE GIVING INTO A ]
+[ CALL MY-SERVICE RETURNING A ]
+[ CALL MY-SERVICE RETURNING ADDRESS OF A ]
+[ CALL MY-SERVICE RETURNING INTO A ]
+[ CALL MY-SERVICE GIVING NULL ]

# Mixing it up:
+[ CALL MY-SERVICE USING
     BY REFERENCE MY-REFERENCED-DATA
     BY CONTENT MY-CONTENT-DATA
     BY VALUE MY-VALUE-DATA ]

+[ CALL MY-SERVICE USING
     BY CONTENT MY-CONTENT-DATA
     BY VALUE MY-VALUE-DATA
     BY REFERENCE MY-REFERENCED-DATA ]

+[ CALL MY-SERVICE USING
     REFERENCE MY-REFERENCED-DATA
     BY VALUE MY-VALUE-DATA
     CONTENT MY-CONTENT-DATA ]

+[ CALL MY-SERVICE USING
     CONTENT MY-CONTENT-DATA
     VALUE MY-VALUE-DATA
     REFERENCE MY-REFERENCED-DATA ]

+[ CALL MY-SERVICE USING
     MY-REFERENCED-DATA
     BY VALUE MY-VALUE-DATA
     BY CONTENT MY-CONTENT-DATA ]

+[ CALL MY-SERVICE USING
     BY REFERENCE MY-REFERENCED-DATA
     BY CONTENT MY-CONTENT-DATA
     BY VALUE MY-VALUE-DATA
     BY REFERENCE MY-OTHER-REFERENCED-DATA ]

+[ CALL MY-SERVICE USING
     BY CONTENT MY-CONTENT-DATA
     BY REFERENCE MY-REFERENCED-DATA
     BY CONTENT MY-OTHER-CONTENT-DATA ]

+[ CALL MY-SERVICE USING
     BY REFERENCE MY-REFERENCED-DATA
     BY CONTENT MY-CONTENT-DATA
     BY REFERENCE MY-OTHER-REFERENCED-DATA
     BY CONTENT MY-OTHER-CONTENT-DATA ]

+[ CALL MY-SERVICE USING
     BY CONTENT MY-CONTENT-DATA
     BY REFERENCE MY-REFERENCED-DATA
     BY CONTENT MY-OTHER-CONTENT-DATA
     BY REFERENCE MY-OTHER-REFERENCED-DATA ]

+[ CALL MY-SERVICE USING
     MY-REFERENCED-DATA
     BY CONTENT MY-CONTENT-DATA
     BY REFERENCE MY-OTHER-REFERENCED-DATA
     BY CONTENT MY-OTHER-CONTENT-DATA ]

# "ON OVERFLOW":
+[ CALL MY-SERVICE
     ON OVERFLOW
        DISPLAY "SERVICE OVERFLOW" ]

+[ CALL MY-SERVICE
     OVERFLOW
        DISPLAY "SERVICE OVERFLOW" ]

# "ON EXCEPTION":
+[ CALL MY-SERVICE
     ON EXCEPTION
        DISPLAY "SERVICE EXCEPTION" ]

+[ CALL MY-SERVICE
     EXCEPTION
        DISPLAY "SERVICE EXCEPTION" ]

# "NOT ON EXCEPTION":
+[ CALL MY-SERVICE
     NOT ON EXCEPTION
        DISPLAY "NO SERVICE EXCEPTION" ]

+[ CALL MY-SERVICE
     NOT EXCEPTION
        DISPLAY "NO SERVICE EXCEPTION" ]

# OVERFLOW and EXCEPTION cannot coexist:

-[ CALL MY-SERVICE
     ON EXCEPTION
        DISPLAY "SERVICE EXCEPTION"
     ON OVERFLOW
        DISPLAY "SERVICE OVERFLOW" ]

-[ CALL MY-SERVICE
     NOT ON EXCEPTION
        DISPLAY "SERVICE EXCEPTION"
     ON OVERFLOW
        DISPLAY "SERVICE OVERFLOW" ]

# "END-CALL":
+[ CALL MY-SERVICE END-CALL ]
+[ CALL MY-SERVICE USING MY-DATA END-CALL ]
+[ CALL MY-SERVICE
 	 ON EXCEPTION
		DISPLAY "SERVICE EXCEPTION"
   END-CALL ]


# Sample from issue #13, by Simon Sobisch.
+ [ CALL 'sub'
      USING '123'
            OMITTED
            OMITTED
            '456'
    END-CALL ]

+[ CALL foo 'bar' ]
+[ CALL foo 'bar' USING baz ]

+[ CALL foo AS bar ]
+[ CALL 'sub' AS bar ]
+[ CALL NESTED ]
+[ CALL NESTED ]
+[ CALL 'sub' AS NESTED ]
+[ CALL 'sub' AS NESTED USING CONTENT foo + 1 ]
+[ CALL 'sub' AS NESTED USING VALUE foo + 1 ]

# Calling alphanumeric hexadecimal literals is allowed:

+[ CALL x"AF" USING set-bit-pairs user-key-control ]
+[ CALL nx"AF" USING set-bit-pairs user-key-control ]

# ...but not numeric hexadecimals:

-[ CALL h"AF" USING set-bit-pairs user-key-control ]

# Arithmetic operations are not permitted in USING BY REFERENCE clauses:

-[ CALL 'sub' AS NESTED USING foo + 1 ]
-[ CALL 'sub' AS NESTED USING REFERENCE foo + 1 ]


+[ CALL foo "bar"
     USING BY REFERENCE bar-name
           BY REFERENCE bar-handle
           BY VALUE     0 SIZE 4
     RETURNING bar-status
   END-CALL ]

+[ CALL foo "bar"
     USING BY VALUE bar-handle
           BY REFERENCE baz
           BY VALUE LENGTH OF baz SIZE 4
     RETURNING ret
   END-CALL ]
